const Background=function(){"use strict";return{launch:function(){V.setNode("body",CanvasComponents.background())}}}(),Canvas=function(){"use strict";const e=V.getSetting("sourceEndpoint");function t(e,t=(e?e.path:"")){Chat.drawMessageForm("clear"),function(){if(!V.getState("serviceNav")){const e=Object.keys(V.getSetting("plugins")),t=V.getState("availablePlugins");e.map(e=>t[e]?t[e]():null),User.launch()}V.getSetting("demoContent")&&V.setEntity(DemoContent.mongoArr[4])}(),V.getNode("background")||(Background.launch(),Haze.launch(),Feature.launch(),Header.launch(),Logo.launch(),Page.launch(),Button.launch(),V.setNode("balance",AccountComponents.headerBalance(-1)),VMap.setMap()),V.aE()||V.setAuth().then(e=>{if(e.success)return console.log("auth success"),e.data[0].uuidE;throw new Error("could not set auth")}).then(e=>V.getEntity(e)).then(e=>{if(!e.success)throw new Error("could not get entity after set auth");V.setActiveEntity(e.data[0]),Join.draw("new entity was set up")}).catch(e=>{V.setTempRefreshToken(),console.log("auth unsuccessful -",e),V.getLocal("last-connected-address")&&window.ethereum?Join.draw("authenticate"):Join.launch()}),V.castRoute(t).then((e,t=e.status,n=e.data[0])=>{["home"].includes(t)?Marketplace.draw():["market","market category","pool"].includes(t)?Marketplace.draw(n):["media","media category"].includes(t)?Media.draw(n):["data"].includes(t)?Data.draw(n):["user profile"].includes(t)?User.draw(n):["user account"].includes(t)?Account.draw(n):["user entities"].includes(t)?EntityList.draw(n):["user settings"].includes(t)?Settings.draw(n):["chat everyone"].includes(t)?Chat.draw(n):["profile"].includes(t)&&Profile.draw(n)}).catch(()=>{Marketplace.draw(),Modal.draw("404")})}function n(e){e.some(e=>{V.getVisibility("#"+e)&&V.getNode("#"+e).click()})}return{launch:async function(){await async function(){V.getSetting("useBuilds")?await Promise.all([V.setStylesheet(e+"/css/builds/v.min.css")]).then(()=>console.log("Success loading css build")).catch(()=>console.error("Error loading css build")):await Promise.all([V.setStylesheet(e+"/css/src/0_0_variables.css"),V.setStylesheet(e+"/css/src/1_0_reset-normalize.css"),V.setStylesheet(e+"/css/src/1_1_reset.css"),V.setStylesheet(e+"/css/src/2_0_typography.css"),V.setStylesheet(e+"/css/src/2_2_color.css"),V.setStylesheet(e+"/css/src/3_0_utilities.css"),V.setStylesheet(e+"/css/src/4_0_components.css"),V.setStylesheet(e+"/css/src/8_0_overrides.css"),V.setStylesheet(e+"/css/src/9_0_leaflet.css")]).then(()=>console.log("Success loading CSS source files")).catch(()=>console.error("Error loading CSS source files"))}(),await async function(){V.getSetting("useBuilds")||await Promise.all([V.setScript(e+"/theme/src/canvas/components.js"),V.setScript(e+"/theme/src/canvas/background.js"),V.setScript(e+"/theme/src/canvas/haze.js"),V.setScript(e+"/theme/src/canvas/logo.js"),V.setScript(e+"/theme/src/canvas/feature.js"),V.setScript(e+"/theme/src/canvas/header.js"),V.setScript(e+"/theme/src/canvas/page.js"),V.setScript(e+"/theme/src/modal/components.js"),V.setScript(e+"/theme/src/modal/modal.js"),V.setScript(e+"/theme/src/interaction/components.js"),V.setScript(e+"/theme/src/interaction/button.js"),V.setScript(e+"/theme/src/interaction/form.js"),V.setScript(e+"/theme/src/interaction/join.js"),V.setScript(e+"/theme/src/navigation/components.js"),V.setScript(e+"/theme/src/navigation/navigation.js")]).then(()=>console.log("Success loading theme source files")).catch(()=>console.error("Error loading theme source files")),V.getSetting("useBuilds")?await Promise.all([V.setScript(e+"/plugins/builds/vplugins.min.js")]).then(()=>console.log("Success loading plugin build")).catch(()=>console.error("Error loading plugin build")):await Promise.all([V.setScript(e+"/plugins/src/account/components.js"),V.setScript(e+"/plugins/src/account/account.js"),V.setScript(e+"/plugins/src/entity/components.js"),V.setScript(e+"/plugins/src/entity/editable.js"),V.setScript(e+"/plugins/src/entity/display.js"),V.setScript(e+"/plugins/src/entity/settings.js"),V.setScript(e+"/plugins/src/entity/entitylist.js"),V.setScript(e+"/plugins/src/chat/components.js"),V.setScript(e+"/plugins/src/chat/chat.js"),V.setScript(e+"/plugins/dependencies/leaflet.js"),V.setScript(e+"/plugins/src/map/map.js"),V.setScript(e+"/plugins/src/google/google.js"),V.setScript(e+"/plugins/src/data/components.js"),V.setScript(e+"/plugins/src/data/data.js"),V.setScript(e+"/plugins/src/marketplace/components.js"),V.setScript(e+"/plugins/src/marketplace/marketplace.js"),V.setScript(e+"/plugins/src/media/components.js"),V.setScript(e+"/plugins/src/media/media.js")]).then(()=>console.log("Success loading plugin source files")).catch(()=>console.error("Error loading plugin source files")),V.setNode("body",""),V.getSetting("demoContent")&&await Promise.all([V.setScript(e+"/assets/demo-content/demo-content.js")]).then(()=>console.log("Success loading demo content")).catch(()=>console.error("Error loading demo content"))}(),function(){V.setState("screen",{height:Number(window.innerHeight),width:Number(window.innerWidth),brandPrimary:V.getCss("--brandPrimary"),brandSecondary:V.getCss("--brandSecondary"),buttonBkg:V.getCss("--buttonBkg")}),V.setState("active",{}),V.setState("page",{height:V.getCss("--page-position-peek"),top:V.setPipe(V.getCss,V.castRemToPixel)("--page-position-top"),topSelected:V.setPipe(V.getCss,V.castRemToPixel)("--page-position-top-selected"),peek:V.getCss("--page-position-peek"),closed:V.getCss("--page-position-closed"),detach:V.setPipe(V.getCss,V.castRemToPixel)("--desktop-page-detach")});const e=V.getState();V.setState("page",{topCalc:e.screen.height-e.page.top-1.5*e.page.detach}),V.setState("page",{topSelectedCalc:e.screen.height-e.page.topSelected-1.5*e.page.detach}),V.setState("page",{featureCalc:Math.floor(e.screen.height-e.page.topSelected-9*(e.screen.width<600?e.screen.width:600)/16)}),V.setState("page",{featureDimensions:{width:e.screen.width<600?e.screen.width:495,height:Math.floor(9*(e.screen.width<600?e.screen.width:495)/16)}}),V.setState("header",{isHazed:!1,serviceNavTop:V.setPipe(V.getCss,V.castRemToPixel,Number)("--service-nav-top"),serviceNavLeft:V.getCss("--service-nav-left"),entityNavTop:V.getCss("--entity-nav-top"),entityNavLeft:V.getCss("--entity-nav-left")})}(),window.onresize=function(){const e=V.getState("screen");window.innerHeight<e.height/3*2&&!V.getVisibility("form")?V.getNode("page").classList.add("page-full-screen"):V.getNode("page").classList.remove("page-full-screen")},document.addEventListener("keydown",(function(e){const t=window.event?e.keyCode:e.which;13==t?(V.getVisibility("#query")||V.getVisibility("#search"))&&(e.preventDefault(),n(["search","query"])):27==t&&(e.preventDefault(),CanvasComponents.handleClosePopup(),n(["close","modal-close"]))})),document.documentElement.style.setProperty("--screen-height",window.innerHeight+"px"),document.documentElement.style.setProperty("--screen-width",window.innerWidth+"px"),V.setStyle("font-styles",{"@font-face":{"font-family":"IBM Plex Regular",src:"url("+V.getSetting("sourceEndpoint")+"/assets/font/IBMPlexSans-Regular.ttf) format('truetype')","font-display":"fallback","unicode-range":"U+000-024F"},"@font-face-2":{"font-family":"IBM Plex Medium",src:"url("+V.getSetting("sourceEndpoint")+"/assets/font/IBMPlexSans-Medium.ttf) format('truetype')","font-display":"fallback","unicode-range":"U+000-024F"},"@font-face-3":{"font-family":"IBM Plex Bold",src:"url("+V.getSetting("sourceEndpoint")+"/assets/font/IBMPlexSans-Bold.ttf) format('truetype')","font-display":"fallback","unicode-range":"U+000-024F"}})},draw:function(e){t(e)}}}(),CanvasComponents=function(){"use strict";V.setStyle({"list > *:last-child":{"padding-bottom":"160px"},"card__top-left":{width:"25%"},"card__bottom-left":{display:"grid","justify-items":"center","text-align":"center",width:"25%"},"card__top-right":{width:"69%"},"card__bottom-right":{width:"69%"},card__unit:{width:"100%"},card__container:{"max-width":"360px","flex-wrap":"wrap"},background:{background:"rgba(211,232,235,1)",height:"100vh","z-index":-2},haze:{top:0,height:"45vh","z-index":-1},handle:{"padding-top":"12px",height:"26px",display:"block"},handle__bar:{"margin-left":"auto","margin-right":"auto",height:"4px",width:"5%","max-width":"40px"},page:{bottom:0,height:"var(--page-position-peek)"},"page-full-screen":{top:0,bottom:"0 !important",height:"unset !important"},"network-logo":{height:"18px"}});const e={transaction:"No transactions found",message:"No messages found",entity:"No entities found",marketplace:"No network items found",media:"No media items found",close:"close"};function t(){V.setNode(".leaflet-popup-pane",""),V.getVisibility(".popup")&&V.setAnimation(".popup",{opacity:0},{duration:.8},{delay:.5}).then(()=>{V.setNode(".popup-content","")})}return{notFound:function(t){return V.setNode({t:"p",c:"pxy",h:(n=e[t],V.i18n(n,"canvas",o||"not found")+" ")});var n,o},background:function(){return V.setNode({t:"background",id:"background",k:t,c:"background fixed w-screen"})},haze:function(){return V.setNode({t:"haze",c:"haze fixed w-screen bkg-white hidden"})},feature:function(){const e=V.getState("page").featureDimensions;return V.setNode({t:"feature",c:"feature fixed hidden",setStyle:{feature:{top:"var(--page-position-top-selected)",height:e.height+"px",width:e.width+"px",background:"white"}}})},balance:function(){const e=V.getState("screen");return V.setNode({t:"balance",c:"balance fixed cursor-pointer txt-anchor-mid",y:e.width>800?{top:"12px",left:"12px"}:{top:"2px",left:"2px"}})},interactions:function(){const e=V.getState("screen");return V.setNode({t:"interactions",c:"interactions fixed",s:{interactions:{top:e.width>800?"23px":"11px",right:0,width:"45%"}},h:{t:"ul",c:"flex items-center justify-end"}})},handle:function(){return V.setNode({t:"handle",c:"handle",h:{t:"div",c:"handle__bar rounded-full bkg-offblack"}})},topSlider:function(){return V.setNode({t:"topslider"})},slider:function(){return V.castNode({t:"slider",c:"flex overflow-x-scroll list-none pb-s"})},listings:function(){return V.setNode({t:"listings"})},list:function(e){const t=V.setNode({t:"list",c:"list flex flex-wrap content-start justify-evenly overflow-y-scroll list-none h-full"});return"narrow"==e&&(t.style["max-width"]="380px",t.style.margin="0 auto"),t},card:function(e,t,n){return V.setNode({t:"li",c:"pxy w-screen max-w-380",i:n,h:{t:"card",c:"card__container flex card-shadow rounded bkg-white pxy",h:t?[{t:"h2",c:"w-full font-bold pxy capitalize",h:t},e]:e}})},header:function(){return V.setNode({t:"header"})},page:function(){return V.setNode({t:"page",c:"page fixed w-screen bkg-white pill-shadow overflow-hidden"})},content:function(){return V.setNode({t:"content"})},topContent:function(){return V.setNode({t:"topcontent"})},logo:function(){return V.cN({t:"logo",c:"fixed hidden w-screen",k:t,h:{t:"div",c:"popup",h:[{t:"div",c:"popup-content-wrapper flex flex-wrap justify-center items-center",h:[{t:"div",c:"popup-content"}]},{t:"div",c:"popup-tip-container",h:{t:"div",c:"popup-tip"}}]}})},networkLogo:function(){return V.cN({t:"img",c:"network-logo",src:V.getSetting("logo")})},handleClosePopup:t}}(),Feature=function(){"use strict";function e(e){return{$content:"object"==typeof e?e:e.content?e.content:void 0,fade:e.fade}}function t(e){const t=V.getNode("feature");"out"!=e.fade?("in"==e.fade||e.$content)&&(t.textContent="",V.setNode(t,e.$content),V.setAnimation("feature","fadeIn")):V.setAnimation("feature","fadeOut")}return{launch:function(){V.setNode("body",CanvasComponents.feature())},draw:function(n){V.setPipe(e,t)(n)}}}(),Haze=function(){"use strict";return{launch:function(){V.setNode("body",CanvasComponents.haze())},draw:function(e){!function(e){if(e&&"out"==e.fade)return V.setState("header",{isHazed:!1}),void V.setAnimation("haze","fadeOut",{delay:.1,duration:1});1!=V.getState("header").isHazed&&(V.setState("header",{isHazed:!0}),V.setAnimation("haze","fadeIn",{delay:2,duration:3}))}(e)}}}(),Header=function(){"use strict";return{launch:function(){const e=CanvasComponents.header(),t=CanvasComponents.balance(),n=NavComponents.entityNav(),o=NavComponents.userNav(),a=NavComponents.serviceNav(),i=CanvasComponents.interactions();V.setNode(e,[t,n,o,a,i]),V.setNode("body",e)}}}(),Logo=function(){"use strict";function e(){const e=V.getNode("page").getBoundingClientRect();V.setNode("logo",CanvasComponents.networkLogo()),t(e.height>V.getState("page").closed?"peek":"closed")}function t(e){const t=V.getNode("logo"),n=V.getState("screen");"closed"==e?V.setAnimation(t,n.width<800?{bottom:"40px",left:"4px"}:{bottom:"70px",left:"35px"},{delay:.5}):"peek"==e&&V.setAnimation(t,n.width<800?{bottom:"110px",left:"4px"}:{bottom:"140px",left:"35px"},{delay:.5}),V.getVisibility("logo")||V.setAnimation(t,"fadeIn",{delay:1,duration:3})}return{launch:function(){V.setNode("body",CanvasComponents.logo()),setTimeout(e,2500)},draw:function(e){!function(e){t(e)}(e)}}}(),Page=function(){"use strict";const e={};function t(t){t&&(0!=t.reset&&(e.$topcontent.textContent="",e.$topslider.textContent="",e.$listings.textContent=""),t.topcontent&&V.setNode(e.$topcontent,t.topcontent),t.topslider&&V.setNode(e.$topslider,t.topslider),t.listings&&V.setNode(e.$listings,t.listings),(t.position||t.pos)&&function(t,o,a,i){const s=V.getNode("list"),c=V.getNode("page"),r=V.getState("page"),l=V.getState("screen");"bottom"==o&&(s.scrollTop=s.scrollHeight);const d=function(e){const t=V.getState("page"),n=V.getState("active");switch(e){case"top":return n&&n.navItem?t.topSelectedCalc:t.topCalc;case"feature":return t.featureCalc;case"peek":return t.peek;default:return t.closed}}(t);if(d==r.height)return;V.setAnimation(e.$page,{height:d+"px"},{duration:3}).then(()=>{V.setState("page",{height:d}),s&&!o&&(s.scrollTop=0)}),"top"==t?(window.innerHeight<l.height/3*2&&V.getNode("page").classList.add("page-full-screen"),l.width<800&&(Haze.draw(),c.classList.remove("pill-shadow")),Feature.draw({fade:"out"}),CanvasComponents.handleClosePopup(),n(7,22)):"feature"==t?(l.width<800&&(c.classList.remove("pill-shadow"),c.classList.remove("page-full-screen")),l.width<800&&(null==a||0!=a)&&Haze.draw(),CanvasComponents.handleClosePopup(),n(7,22)):"closed"==t?(Haze.draw({fade:"out"}),Feature.draw({fade:"out"}),CanvasComponents.handleClosePopup(),n(5,35),c.classList.add("pill-shadow"),c.classList.remove("page-full-screen"),Logo.draw(t),null!=i&&0==i||Navigation.drawReset()):"peek"==t&&(Haze.draw({fade:"out"}),Feature.draw({fade:"out"}),n(5,25),c.classList.add("pill-shadow"),c.classList.remove("page-full-screen"),Logo.draw(t))}(t.position||t.pos,t.scroll,t.haze,t.navReset))}function n(e,t){V.setAnimation(".handle__bar",{width:e+"%"}),V.setAnimation("handle",{height:t+"px"})}return{launch:function(){!function(){const t=CanvasComponents.page(),n=CanvasComponents.handle(),o=CanvasComponents.content(),a=CanvasComponents.topContent(),i=CanvasComponents.topSlider(),s=CanvasComponents.listings();function c(e){V.setState("flick",{startX:e.changedTouches[0].clientX}),V.setState("flick",{startY:e.changedTouches[0].clientY})}function r(e){V.setState("flick",{endX:e.changedTouches[0].clientX}),V.setState("flick",{endY:e.changedTouches[0].clientY});const t=V.getNode("list");let n=!0;t&&t.scrollTop>0&&"listings"==e.currentTarget.localName&&(n=!1);const o=V.getState("page"),a=V.getState("flick");Math.abs(a.startX-a.endX)<100&&a.startY>a.endY+15?o.height==o.peek||o.height==o.featureCalc?Page.draw({position:"top",reset:!1}):o.height==o.closed&&Page.draw({position:"peek",reset:!1}):n&&Math.abs(a.startX-a.endX)<100&&a.startY<a.endY-15&&(o.height==o.peek?Page.draw({position:"closed",reset:!1}):(o.height==o.featureCalc||o.height>=o.topCalc)&&Page.draw({position:"peek",reset:!1}))}n.addEventListener("click",(function(){const e=V.getState("page");e.height==e.closed?Page.draw({position:"peek",reset:!1}):e.height==e.peek?Page.draw({position:"top",reset:!1}):(e.height==e.featureCalc||e.height>=e.topCalc)&&Page.draw({position:"closed",reset:!1})})),n.addEventListener("touchstart",c),n.addEventListener("touchend",r),a.addEventListener("touchstart",c),a.addEventListener("touchend",r),i.addEventListener("touchstart",c),i.addEventListener("touchend",r),s.addEventListener("touchstart",c),s.addEventListener("touchend",r),V.setNode(o,[a,i,s]),V.setNode(t,[n,o]),V.setNode("body",t),e.$page=V.getNode("page"),e.$topcontent=V.getNode("topcontent"),e.$topslider=V.getNode("topslider"),e.$listings=V.getNode("listings")}()},draw:function(e){return Promise.resolve(t(e))}}}(),Button=function(){"use strict";function e(t){const n=V.getNode("form"),o=n.getNode("#plusform__loc"),a={title:n.getNode("#plusform__title").value,role:V.getNavItem("active","serviceNav").use.role,location:o.value,lat:o.value&&o.getAttribute("lat")||void 0,lng:o.value&&o.getAttribute("lng")||void 0,description:n.getNode("#plusform__descr").value,unit:n.getNode("#plusform__unit").value,target:n.getNode("#plusform__target").value};V.aE()?(V.setEntity(a).then(n=>{n.success?(console.log(n.message),console.log("set uuidE:",n.data[0].uuidE),t.target.addEventListener("click",e),V.setCache("all","clear"),V.setCache(n.data[0].role,"clear"),V.setBrowserHistory(n.data[0].path),Navigation.drawEntityNavPill(n.data[0]),User.draw(n.data[0].path),Button.draw("set",{fade:"out"}),Form.draw("all",{fade:"out"}),"MongoDB"==V.getSetting("entityLedger")&&V.setEntity(V.aE().fullId,{field:"adminOf",data:n.data[0].fullId}),V.setCache("preview",n.data)):(Form.draw("error",n),t.target.addEventListener("click",e),console.error(n))}),V.setLocal("last-form",void 0)):(V.setLocal("last-form",a),Join.draw("authenticate"))}function t(){const e=V.getNode("#search-input").value;if(e.length<2)return;const t={query:e};Marketplace.draw(V.getState("active").navItem,t)}function n(){Page.draw({position:"closed",reset:!1,navReset:!1}),Form.draw("search")}function o(){Page.draw({position:"closed",reset:!1,navReset:!1}),Form.draw(V.getNavItem("active","serviceNav").use.form)}function a(){V.setBrowserHistory("/me/transfers"),V.setState("active",{lastViewed:V.getNode(".pill__replace").textContent}),Canvas.draw({path:"/me/transfers"})}return{launch:function(){!function(){const i=InteractionComponents.filter(),s=InteractionComponents.searchBtn(),c=InteractionComponents.query(),r=InteractionComponents.plus(),l=InteractionComponents.set(),d=InteractionComponents.sendNav();r.addEventListener("click",o),s.addEventListener("click",n),c.addEventListener("click",t),l.addEventListener("click",e,{once:!0}),d.addEventListener("click",a),V.setNode("interactions > ul",[r,i,s,c,l,d])}()},draw:function(e,t){!function(e,t){const n="all"==e?["filter","search","plus","set","send","query"]:e.split(" ");let o="fadeIn",a=.2;t&&"out"==t.fade&&(o="fadeOut"),t&&t.delay&&(a=t.delay),n.forEach(e=>{V.setAnimation("#"+e,o,{delay:a,duration:.5})})}(e,t)}}}(),InteractionComponents=function(){"use strict";const e="cursor-pointer hidden pr-s",t="uploading...",n="Change",o="Image",a="Enter a title or city name",i="Key",s="Title",c="Location",r="Description and Links",l="Target",d="Unit",u="Search",p="create",g="search",f="Watch intro",h="Connect a new crypto wallet",m="Ask a friend to transfer 1 VALUE to progress your verification.",v="Verify with BrightID to receive VALUE basic income.";function y(e,t){return V.i18n(e,"interaction",t||"interaction content")+" "}function w(e){V.setNode("#img-upload__label",y(t)),V.castImageUpload(e).then(e=>{V.setNode("#img-upload__label",y(n)),V.setNode("#img-upload__preview",""),V.setNode("#img-upload__preview",V.cN({t:"img",y:{"max-width":"25px","max-height":"20px","margin-left":"10px"},src:e.src}))})}function N(){V.setState("active",{navItem:"/media"}),setTimeout(()=>{V.getNode('[path="/media"]').click()},350)}function b(e,t){return V.cN({t:"div",c:"circle-1 flex justify-center items-center rounded-full bkg-white transition pill-shadow"+(t?" "+t:""),h:V.getIcon(e)})}return{filter:function(){return V.cN({t:"li",id:"filter",c:e,h:b("filter_list")})},searchBtn:function(){return V.cN({t:"li",id:"search",c:e,h:b("search")})},query:function(){return V.cN({t:"li",id:"query",c:e,h:{t:"div",c:"create-btn pxy",h:y(g)}})},plus:function(){return V.cN({t:"li",id:"plus",c:e,h:b("+")})},close:function(){return V.cN({t:"li",id:"close",c:e,h:b("close")})},set:function(){return V.cN({t:"li",id:"set",c:e,h:{t:"div",c:"create-btn pxy",h:y(p)}})},sendNav:function(){return V.cN({t:"li",id:"send",c:e,h:b("send")})},sendBtn:function(){return V.cN({t:"button",i:"send-message",c:"circle-1 flex justify-center items-center rounded-full bkg-white",h:V.cN({t:"span",c:"sendbtn",s:{sendbtn:{position:"relative",left:"1px",top:"1px",opacity:"0.75"}},h:V.getIcon("send")})})},form:function(){return V.setNode({tag:"form",classes:"form fixed w-screen hidden bkg-white pxy",setStyle:{form:{"padding-top":"calc(var(--page-position-top-selected) + 5px) !important",height:"100%","z-index":-1}},h:{t:"div",c:"form__response pxy txt-red"}})},formField:function(e,t,n,o){const a={uPhrase:{label:y(i),inputId:"loginform__uphrase",attributes:{type:"password",autocomplete:"off"}},title:{label:y(s),inputId:"plusform__title",attributes:{value:t,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}},location:{label:y(c),inputId:"plusform__loc",attributes:{value:t,lat:n,lng:o,autocomplete:"off"}},description:{label:y(r),inputId:"plusform__descr",multiline:!0},target:{label:y(l),inputId:"plusform__target",fieldClasses:"flex-grow w-30%"},unit:{label:y(d),inputId:"plusform__unit",fieldClasses:"flex-grow w-30%"},search:{label:y(u),inputId:"search-input",attributes:{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}}};function p(){this.closest(".field").classList+=" field--static field--focus"}function g(){const e=this.closest(".field").classList;this.value||e.remove("field--static"),e.remove("field--focus")}const f=V.cN({t:"div",c:"field__input-container"}),h=V.cN({t:"div",c:"field__label-wrapper",h:{t:"label",c:"field__label label-primary",h:{t:"span",c:"label__content",h:a[e].label}}}),m=V.cN({t:"input",c:"field__input",id:a[e].inputId,e:{focus:p,blur:g},a:a[e].attributes||{value:t}}),v=V.cN({t:"textarea",c:"field__input auto-height",id:a[e].inputId,a:{row:"1"},h:t,e:{input:function(){this.style.height="1px",this.style.height=this.scrollHeight+"px"},focus:p,blur:g}});a[e].multiline?V.setNode(f,[h,v]):V.setNode(f,[h,m]);const w=a[e].fieldClasses||"",N=t?" field--static":"";return V.cN({t:"div",c:"field pxy "+w+N,h:{t:"div",c:"field__border",h:{t:"div",c:"field__internal",h:f}}})},formUploadImage:function(){return V.cN({t:"div",c:"pxy w-30%",h:{t:"div",s:{"upload-field":{padding:"16px 12px 17px","align-items":"center",border:"1px solid #DBDAE3","border-radius":"2px",color:"#6F7287","font-size":"14px",transition:"border 240ms cubic-bezier(0.4, 0, 0.3, 1)"},"upload-field:hover":{border:"1px solid #A9A8B3"}},c:"upload-field relative flex flex-grow",h:[{t:"label",i:"img-upload__label",c:"w-full cursor-pointer",a:{for:"img-upload__file"},h:y(o)},{t:"input",i:"img-upload__file",c:"hidden",a:{type:"file",accept:"image/*"},e:{change:w}},{t:"div",i:"img-upload__preview",y:{position:"absolute",right:"10px"}}]}})},formSearchFilter:function(){return V.cN({t:"div",h:[{t:"p",c:"pxy",h:y(a)}]})},joinBtn:function(){const e=V.getState("screen"),t="rgba("+e.buttonBkg+", 1)";return V.cN({t:"join",i:"join",c:"fixed cursor-pointer txt-anchor-mid",y:e.width>800?{top:"12px",left:"12px"}:{top:"2px",left:"2px"},h:{svg:!0,t:"svg",a:{width:e.width>800?"66px":"54px",viewBox:"0 0 36 36"},h:[{svg:!0,t:"circle",a:{"stroke-dasharray":"100",transform:"rotate(-90, 18, 18) translate(0, 36) scale(1, -1)","stroke-dashoffset":"-200",cx:"18",cy:"18",r:"15.91549430918954",fill:t,stroke:t,"stroke-width":"2.7"}},{svg:!0,t:"text",c:"font-medium fs-xs txt-button",a:{x:"50%",y:"59%"},h:"Join"}]}})},onboardingCard:function(){const e=V.getSetting("transactionLedger");if(V.aE()&&"EVM"==e){let e;const t=!!(V.aE().balance&&V.aE().balance.balance.liveBalance>0);return V.cA()?t||"Person"!=V.aE().role?t&&"Person"==V.aE().role?(e=V.castNode({tag:"div",c:"flex w-full items-center justify-evenly",html:"<p>👋 "+y(v,"onboarding call to action")+"</p>"}),CanvasComponents.card(e)):"":(e=V.castNode({tag:"div",c:"flex w-full items-center justify-evenly",html:"<p>👋 "+y(m,"onboarding call to action")+"</p>"}),CanvasComponents.card(e)):(e=V.castNode({tag:"div",c:"flex w-full items-center justify-evenly",html:"<p>👋 "+y(h,"onboarding call to action")+"</p>"}),e.addEventListener("click",(function(){window.Web3Obj?Join.draw("authenticate existing entity"):Join.draw("install metamask")})),CanvasComponents.card(e))}return""},getStarted:function(){return V.cN({t:"li",i:"get-started",s:{getstarted:{background:"rgb(255,112,148)",color:"white"}},c:"pill getstarted flex justify-center items-center rounded-full cursor-pointer no-txt-select whitespace-no-wrap",h:y(f),k:N})}}}(),Form=function(){"use strict";return{draw:function(e,t){!function(e){if(e.fadeOut)V.getNode("form")&&V.setAnimation("form","fadeOut",{delay:.2,duration:1}).then(()=>{V.setNode("form","clear")});else if(e.success){const t=InteractionComponents.form();if("new entity"==e.layout){const n=e.data[0];V.setNode(t,[InteractionComponents.formField("title",n.title),InteractionComponents.formField("location",n.location,n.lat,n.lng),InteractionComponents.formField("description",n.description),V.cN({t:"div",c:"flex",h:[InteractionComponents.formUploadImage(),InteractionComponents.formField("target",n.target),InteractionComponents.formField("unit",n.unit)]})])}else"search"==e.layout?V.setNode(t,[InteractionComponents.formField("search"),InteractionComponents.formSearchFilter()]):V.setNode(t,[InteractionComponents.title(),InteractionComponents.desc()]);V.setNode("body",t),setTimeout(()=>{V.getVisibility("#search-input")&&V.getNode("#search-input").focus(),V.getVisibility("#plusform__title")&&V.getNode("#plusform__title").focus()},600),V.setAnimation("form","fadeIn",{delay:.2,duration:1}),Google.launch().then(()=>{Google.initAutocomplete("plusform")}),Button.draw("all",{fade:"out"}),Button.draw("search"==e.layout?"query":"set",{delay:1})}else V.getNode(".form__response").textContent=e.message}(function(e,t){if(t&&"out"==t.fade)return{fadeOut:!0};if("error"==e)return t;let n;if("new entity"==e){n={title:void 0,role:void 0,location:void 0,lat:void 0,lng:void 0,description:void 0,unit:void 0,target:void 0};const e=V.castJson(V.getLocal("last-form"));e&&(n.title=e.title,n.location=e.location,n.lat=e.lat,n.lng=e.lng,n.description=e.description,n.unit=e.unit,n.target=e.target)}return{success:!0,layout:e,data:[n]}}(e,t))}}}(),Join=function(){"use strict";async function e(){return V.cA()?V.getEntity(V.cA()).then(async e=>{if(e.reset)return"entity not found";if(e.success){V.setActiveEntity(e.data[0]);const t=await V.getEntityBalance(e.data[0]);return t.success?V.setState("activeEntity",{balance:{success:!0,balance:t.data[0]}}):V.setState("activeEntity",{balance:{success:!1,message:t.message.message.message}}),"entity found"}return"entity not found"}):"error"}return{launch:function(){if(!V.getLocal("browser-id")){const e="BRID"+V.castUuid().base64Url.substr(1,16);V.setLocal("browser-id",e)}if(!V.getNode("join")){V.setNode("balance > svg","clear"),V.setLocal("welcome-modal",1);const e=InteractionComponents.joinBtn();e.addEventListener("click",(function(){Join.draw("initialize join")})),V.setNode("header",e)}},draw:function(t){(async function(t){return V.getState("browserWallet")&&"EVM"==V.getSetting("transactionLedger")?"initialize join"==t?t="initialize web3 join":t.includes("authenticate")?await V.setActiveAddress().then(async n=>{if(n.success){const n=await e();t.includes("existing entity")?(V.setLocal("welcome-modal",1),t="authenticate existing entity"):t=n}else t=n.status}):"new entity was set up"==t&&(V.aE()&&V.aE().fullId?t="entity found":V.cA()&&(t=await e())):"Symbol"==V.getSetting("transactionLedger")?"initialize join"==t?t="web2 login":"new entity was set up"==t&&(V.setLocal("last-connected-address",V.aE().symbolCredentials.address),t="entity found"):"initialize join"==t?t="initialize web2 join":"new entity was set up"==t&&(t="entity found"),t})(t).then(e=>{!function(e){if(console.log("join: ",e),"entity found"==e){V.setNode("join","clear"),V.setNode(".modal","clear"),1==V.getLocal("welcome-modal")&&(Modal.draw(e),V.setLocal("welcome-modal",0));const t=V.aE().balance;t?t&&t.success?Account.drawHeaderBalance(t.balance.balance):Modal.draw("could not get balance"):Account.drawHeaderBalance(),setInterval(Account.drawHeaderBalance,1e3*V.getSetting("balanceCheckInterval"))}else"entity not found"==e?(V.sN("balance > svg","clear"),Join.launch(),Modal.draw(e)):"logged out"==e||"user denied auth"==e?(Join.launch(),Navigation.draw(),Modal.draw(e)):(Navigation.draw(),Modal.draw(e))}(e)})}}}(),ModalComponents=function(){"use strict";const e={close:"close",connectingWallet:"Connecting wallet",connectWallet:"Connect wallet",useKey:"Use key",nameProfile:"Name profile",joining:"Joining",welcome:"Welcome",connectedAddress:"Address connected",confInWallet:"Confirm in wallet ... ",submitted:"submitted ...",enableWallet:"Enable a crypto wallet in your browser, for example",getMetaMask:"Get MetaMask",signTx:"Sign Transaction",newNameOnly:"Name new profile only",newName:"Name new profile",newNameExplain:"Naming your profile creates a new entity for your address. An entity can be anything you want to make visible in the network.",manageProfile:"Manage profile with key",disconnect:"Confirm Disconnect",useProfile:"Use current profile",copyKey:"Click to copy the key and store it safely elsewhere",copyKeyExplain:"You'll need this key to manage this profile",liveBalance:"Live Balance",notRetrieved:"Sorry, account details could not be retrieved",fourOfour:"404 - Page not found",loggedOut:"You are logged out",entityExists:"This combination of title and tag already exists or is invalid",txSent:"✅ Sent to network",txSuccess:"✅ Transaction successful",error:"An error occured. Maybe the wallet is locked?",wait:"Please wait... requesting data",walletLocked:"Could not unlock wallet. Maybe the site's connectivity to the wallet was denied? Check the browser or wallet settings.",noBalance:"Could not get account balance. Is the network set correctly in your wallet? <br><br>Please set to RINKEBY."};function t(e,t){return V.i18n(e,"modal",t||"modal content")+" "}V.setStyle({modal:{top:"0",right:"0",bottom:"0",left:"0",background:"rgba(0,0,0,0.8)"},modal__content:{background:"white",width:"75vw","max-width":"500px",height:"46vh",margin:"14vh auto",padding:"0.5rem"},modal__close:{position:"absolute",right:"1rem",top:"1rem","text-decoration":"none",color:"white"},modal__uphrase:{color:"red"},"modal-pos-1":{top:"5vh"},"modal-pos-2":{top:"10vh"},"modal-pos-3":{top:"15vh"},"confirm-click-spinner":{"margin-left":"14px"}});const n="relative flex justify-center items-center bkg-button txt-button font-medium cursor-pointer txt-center pxy-1",o="relative cursor-pointer txt-center";function a(){V.setNode(".modal","clear")}function i(e){e.stopPropagation()}function s(){const o=InteractionComponents.formField("uPhrase"),a=V.cN({t:"div",i:"use-key-btn",c:n+" modal-pos-1",k:c,h:t(e.useKey)}),i=V.sN({t:"div",c:"form__response pxy txt-red"});V.sN(".modal__content",""),V.setNode(".modal__content",[o,i,a])}function c(){V.setNode("#use-key-btn",m()),V.setAuth(V.getNode("#loginform__uphrase").value).then(e=>{if(e.success)return console.log("auth success"),e.data[0].uuidE;throw new Error(e.message)}).then(e=>V.getEntity(e)).then(e=>{if(!e.success)throw new Error("could not get entity after set auth");V.setActiveEntity(e.data[0]),Join.draw("new entity was set up")}).catch(e=>{console.log("auth unsuccessful -",e),V.getNode(".form__response").textContent=e,V.setNode(".confirm-click-spinner","clear"),Join.launch()})}function r(){const o=InteractionComponents.formField("title"),a=V.cN({t:"div",i:"name-profile-btn",c:n,k:l,h:t(e.nameProfile)}),i=V.sN({t:"div",c:"joinform__response pxy txt-red"});V.sN(".modal__content",""),V.setNode(".modal__content",[o,i,a])}function l(n){n.stopPropagation(),n.target.removeEventListener("click",l,!1),n.target.textContent=t(e.joining),V.setNode("#name-profile-btn",m()),V.getNode(".joinform__response").textContent="";const o={title:V.getNode("#plusform__title").value,role:"Person",evmAddress:V.cA()};console.log("about to set entity: ",o),V.setEntity(o).then(o=>{o.success?(console.log("successfully set entity: ",o),V.setAuth(o.data[0].auth.uPhrase).then(e=>{e.success?console.log("auth success"):console.log("could not set auth after setting new entity")}),Modal.setTempAuth(o.data[0].auth),V.setActiveEntity(o.data[0]),Join.draw("new entity was set up"),V.setCache("entire cache","clear"),Navigation.drawEntityNavPill(o.data[0])):(console.log("could not set entity: ",o),n.target.addEventListener("click",l),n.target.textContent=t(e.nameProfile),V.getNode(".joinform__response").textContent=o.message)})}function d(e){e.stopPropagation(),V.setNode("#connectwallet-btn",m()),Join.draw("authenticate")}function u(n){n.stopPropagation(),n.target.removeEventListener("click",u,!1);const o=V.getNode("#sign-transaction");o.style.background="white",o.style.color="rgba("+V.getState("screen").brandSecondary+", 1)",V.cA()?o.textContent=t(e.confInWallet):(Modal.draw("transaction sent"),V.drawHashConfirmation(String(V.getState("active").transaction.data[0].timeSecondsUNIX)));const a=V.getState("active").transaction,i=e=>{V.setData(e,"transaction admin notification",V.getSetting("transactionLedgerWeb2"))};V.setTransaction(a).then(e=>{e.success?(V.drawTxConfirmation(e.data[0]),Account.drawHeaderBalance(),i("successfully")):(Modal.draw("error"),console.log(e),i("unsuccessfully"))}).catch(e=>{console.error(e),Modal.draw(),i("unsuccessfully")})}function p(){"EVM"==V.getSetting("transactionLedger")&&V.setEntity(V.aE().fullId,{field:"evmCredentials.address",data:V.cA(),role:V.aE().role}).then(()=>{Join.draw("authenticate")})}function g(e){e.stopPropagation(),window.open("https://metamask.io/download.html","_blank")}function f(){V.setNode("#disconnect-btn",m()),V.setDisconnect()}function h(){return V.cN({t:"div",c:"modal__content relative",k:i})}function m(){return V.cN({svg:!0,t:"svg",c:"confirm-click-spinner",a:{width:"18",height:"18",viewBox:"0 0 50 50"},h:[{svg:!0,t:"path",a:{d:"M25,5A20.14,20.14,0,0,1,45,22.88a2.51,2.51,0,0,0,2.49,2.26h0A2.52,2.52,0,0,0,50,22.33a25.14,25.14,0,0,0-50,0,2.52,2.52,0,0,0,2.5,2.81h0A2.51,2.51,0,0,0,5,22.88,20.14,20.14,0,0,1,25,5Z"},h:{svg:!0,t:"animateTransform",a:{attributeName:"transform",type:"rotate",from:"0 25 25",to:"360 25 25",dur:"0.7s",repeatCount:"indefinite"}}}]})}return{modal:function(){return V.cN({t:"modal",c:"modal fixed",h:{t:"div",i:"modal-close",c:"modal__close",h:t(e.close),k:a},k:a})},modalContent:h,simpleMessage:function(n){const o=h(),a=V.cN({t:"p",h:t(e[n])});return V.setNode(o,a),o},validationError:function(e){const t=h(),n=V.cN({t:"p",h:e});return V.setNode(t,n),t},getMetaMask:function(){const o=h(),a=V.cN({t:"p",c:"txt-center",h:t(e.enableWallet)+' <a href="https://metamask.io/download.html" target="_blank">MetaMask</a>'}),i=V.cN({t:"div",c:"mt-r mb-r ml-auto mr-auto",y:{width:"108px"},h:{t:"img",src:"/assets/img/metamask-fox.png"}}),s=V.cN({t:"div",c:n,k:g,h:t(e.getMetaMask)});return V.setNode(o,[a,i,s]),o},confirmTransaction:function(o){const a=o.data[0],i=h(),s=V.cN({t:"p",c:"modal__p",h:[{t:"p",h:"Amount: "+a.amount},{t:"p",h:"Fee: "+a.feeAmount},{t:"p",h:"Contribution: "+a.contribution},{t:"p",h:"Total: "+a.txTotal}]}),c=V.cN({t:"div",i:"sign-transaction",c:n+" modal-pos-1",k:u,h:t(e.signTx)});return V.setNode(i,[s,c]),i},web3Join:function(){const a=h(),i=V.cN({t:"div",i:"connectwallet-btn",c:n+" modal-pos-1",k:d,h:t(e.connectWallet)}),c=V.cN({t:"p",c:o+" modal-pos-2",k:r,h:t(e.newNameOnly)}),l=V.cN({t:"p",c:o+" modal-pos-3",k:s,h:t(e.manageProfile)});return V.setNode(a,[i,c,l]),a},web2Join:function(){const a=h(),i=V.cN({t:"div",c:n+" modal-pos-1",k:r,h:t(e.newName)}),c=V.cN({t:"p",c:o+" modal-pos-2",k:s,h:t(e.manageProfile)});return V.setNode(a,[i,c]),a},confirmUPhrase:function(){const o=h(),a=V.cN({t:"div",c:n+" modal-pos-1",k:s,h:t(e.manageProfile)});return V.setNode(o,a),o},disconnect:function(){const o=h(),a=V.cN({t:"div",i:"disconnect-btn",c:n+" modal-pos-1",k:f,h:t(e.disconnect)});return V.setNode(o,a),o},connectWallet:function(){const n=h(),o=V.cN({t:"div",c:"preloader",h:[{t:"div",c:"preloader__ring"},{t:"loader",c:"preloader__text",h:t(e.connectingWallet)}]});return V.setNode(n,o),n},mapAddress:function(){const a=h(),i=V.cN({t:"div",c:n+" modal-pos-1",k:p,h:t(e.useProfile)}),s=V.cN({t:"p",c:o+" modal-pos-2",k:r,h:t(e.newName)});return V.setNode(a,[i,s]),a},entityFound:function(n,o,a,i,s){const c=h(),r=V.cN({t:"div",c:"txt-center pxy",h:[{t:"p",h:t(e.welcome)},{t:"p",c:"font-medium fs-l pxy",h:n.fullId},{t:"p",h:o?t(e.connectedAddress):""},{t:"p",c:"fs-s pxy",h:o}]});if(a){const n=V.cN({t:"div",c:"txt-center",y:{background:"aquamarine","border-radius":"3px"},h:[{t:"p",c:"pxy",h:t(e.copyKey)},UserComponents.castAccessKeyNode(a||"","txt-red fs-l"),{t:"p",c:"pxy",h:t(e.copyKeyExplain)}]});V.setNode(c,[r,n])}else V.setNode(c,r);return c},entityNotFound:function(){const a=h(),i=V.cN({t:"div",c:n+" modal-pos-1",k:r,h:t(e.newName)}),s=V.cN({t:"p",c:o+" modal-pos-2",k:p,h:t(e.useProfile)}),c=V.cN({t:"p",c:"modal-pos-3 relative txt-center",h:t(e.newNameExplain)});return V.aE()?V.setNode(a,[i,s,c]):V.setNode(a,[i,c]),a}}}(),Modal=function(){"use strict";let e;return{draw:function(t,n){!function(t,n){const o=ModalComponents.modal();if("entity found"==t)V.setNode(o,ModalComponents.entityFound(V.aE(),V.cA(),!!e&&e.uPhrase,V.getSetting("coinTicker"),V.getSetting("tokenTicker"))),e=void 0;else if("entity not found"==t)V.setNode(o,ModalComponents.entityNotFound());else if("authenticate existing entity"==t)V.setNode(o,ModalComponents.mapAddress());else if("web3 provider not found"==t)V.setNode(o,ModalComponents.tempUser());else if("initialize web3 join"==t)V.setNode(o,ModalComponents.web3Join());else if("initialize web2 join"==t)V.setNode(o,ModalComponents.web2Join());else if("user denied auth"==t)V.setNode(o,ModalComponents.simpleMessage("walletLocked"));else if("could not get balance"==t)V.setNode(o,ModalComponents.simpleMessage("noBalance"));else if("wallet locked"==t)V.setNode(o,ModalComponents.connectWallet());else if("logged out"==t)V.setNode(o,ModalComponents.simpleMessage("loggedOut"));else if("confirm uPhrase"==t)V.setNode(o,ModalComponents.confirmUPhrase());else if("disconnect"==t)V.setNode(o,ModalComponents.disconnect());else if("install metamask"==t)V.setNode(o,ModalComponents.getMetaMask());else if("please wait"==t)V.setNode(o,ModalComponents.simpleMessage("wait"));else if("confirm transaction"==t){const e=V.getState("active").transaction;V.setNode(o,ModalComponents.confirmTransaction(e))}else"transaction sent"==t?(V.setNode(o,ModalComponents.simpleMessage("txSent")),setTimeout(()=>{V.setNode(".modal","clear")},3500)):"transaction successful"==t?(V.setNode(o,ModalComponents.simpleMessage("txSuccess")),setTimeout(()=>{V.setNode(".modal","clear")},3500)):"404"==t?V.setNode(o,ModalComponents.simpleMessage("fourOfour")):"validation error"==t?V.setNode(o,ModalComponents.validationError(n)):V.setNode(o,ModalComponents.simpleMessage("error"));V.setNode(".modal","clear"),V.setNode("body",o)}(t,n)},setTempAuth:function(t){e=t}}}(),NavComponents=function(){"use strict";return V.setStyle({pill:{height:"2.5rem",padding:"0 1.2rem","margin-right":"0.7rem"},pill__entity:{height:"2.5rem",padding:"0 1rem","margin-right":"0.7rem"},"pill--selected":{color:"rgba(var(--brandPrimary), 1)",border:"2px solid rgba(var(--brandPrimary), 1)"},"pill--user-online":{position:"relative",left:"-3px"},pill__placeholderimage:{position:"relative",bottom:"-6px"},pill__img:{position:"relative",left:"-10px",border:"2px solid white"},pill__initials:{position:"relative",right:"3px"},"entity-nav":{"padding-top":"4px","padding-bottom":"8px",top:"var(--entity-nav-top)",left:"var(--entity-nav-left)"},"user-nav":{"padding-top":"4px","padding-bottom":"8px",top:"var(--user-nav-top)",left:"var(--user-nav-left)",display:"none"},"service-nav":{"padding-top":"4px","padding-bottom":"28px",top:"var(--service-nav-top)",left:"var(--service-nav-left)"},"entity-nav__ul":{"padding-left":"3px"},"service-nav__ul":{"padding-left":"3px"},"user-nav__ul":{"padding-left":"3px"},"entity-nav__ul > *:last-child":{visibility:"hidden"},"service-nav__ul > *:last-child":{visibility:"hidden"},"user-nav__ul > *:last-child":{visibility:"hidden"}}),{pill:function(e){return V.cN({t:"li",c:"pill flex justify-center items-center rounded-full bkg-white pill-shadow cursor-pointer no-txt-select whitespace-no-wrap",a:{path:e.path||"/"},h:[{t:"span",h:V.i18n(e.title,"navigation","nav item")}]})},entityPill:function(e){const t=function(e){const t=["rgba("+V.getState("screen").brandSecondary+", 1)"];if(e.useDataUrl)return"url('"+e.tinyImage+"')";if(e.tinyImage){return"url('"+V.castEntityThumbnail(JSON.parse(e.tinyImage)).src+"')"}return t[0]}(e);return V.cN({t:"li",c:(e.tinyImage?"pill__entity":"pill")+" flex justify-center items-center rounded-full bkg-white pill-shadow cursor-pointer no-txt-select whitespace-no-wrap",a:{uuidE:e.uuidE,path:e.path||"/",fullId:e.title+" "+e.tag,initials:e.initials},h:[{t:"div",c:"pill__img circle-0 rounded-full flex justify-center items-center cursor-pointer",a:{style:`background:${t}; background-position: center center; background-size: cover;`},h:{t:"div",c:"card__initials font-bold fs-s txt-white",h:t.includes("url")?"":{svg:!0,t:"svg",a:{class:"pill__placeholderimage txt-white",height:"30",viewBox:"0 0 24 24"},h:[{svg:!0,t:"path",a:{fill:"none",d:"M0 0h24v24H0V0z"}},{svg:!0,t:"path",a:{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v1c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-1c0-2.66-5.33-4-8-4z"}}]}}},{t:"span",c:"pill__initials",h:e.initials}]})},entityNav:function(){return V.cN({t:"entity-nav",c:"nav entity-nav fixed w-screen overflow-x-scroll"})},userNav:function(){return V.cN({t:"user-nav",c:"nav user-nav fixed w-screen overflow-x-scroll"})},serviceNav:function(){return V.cN({t:"service-nav",c:"nav service-nav fixed w-screen overflow-x-scroll"})},entityNavUl:function(){return V.cN({t:"ul",c:"entity-nav__ul flex items-center font-medium fs-rr"})},serviceNavUl:function(){return V.cN({t:"ul",c:"service-nav__ul flex items-center font-medium"})},userNavUl:function(){return V.cN({t:"ul",c:"user-nav__ul flex items-center font-medium"})}}}(),Navigation=function(){"use strict";function e(e){if(e.success){!e.data[0].which&&s();const n=NavComponents.serviceNavUl();n.addEventListener("click",o);const a=t(e.data[0].serviceNav,3);for(let e=0;e<a.length;e++){const t=NavComponents.pill(a[e]);V.setNode(n,t)}V.setNode(n,NavComponents.pill({title:""})),V.setNode("service-nav",""),V.setNode("service-nav",n);const i=NavComponents.entityNavUl();i.addEventListener("click",o);const c=t(e.data[0].entityNav,3);for(let e=0;e<c.length;e++){const t=NavComponents.entityPill(c[e]);V.setNode(i,t)}V.setNode(i,NavComponents.pill({title:"zzzzz"})),V.setNode("entity-nav",""),V.setNode("entity-nav",i);const r=NavComponents.userNavUl();r.addEventListener("click",o);const l=t(e.data[0].userNav,1);for(let e=0;e<l.length;e++){const t=NavComponents.pill(l[e]);V.setNode(r,t)}V.setNode(r,NavComponents.pill({title:"zzzzz"})),V.setNode("user-nav",""),V.setNode("user-nav",r)}const n=e.data[0].which;n&&function(e){const t=V.getNode('[path="'+e+'"]');V.setState("active",{navItem:t.getAttribute("path")});const n=t.closest(".nav"),o=n.localName;"user-nav"==o||V.getVisibility("entity-nav")||(n.style.display="block",V.setAnimation("user-nav","fadeOut",{duration:.1}),V.setAnimation("entity-nav","fadeIn",{duration:.2}),V.setAnimation("service-nav","fadeIn",{duration:.6}));"user-nav"!=o||V.getVisibility("user-nav")||(n.style.display="block",V.setAnimation("entity-nav","fadeOut",{duration:.1}),V.setAnimation("service-nav","fadeOut",{duration:.6}),V.setAnimation("user-nav","fadeIn",{duration:.2}));const s=V.getState("header");a(),function(e){const t=e.getElementsByClassName("pill__initials")[0];t&&(t.textContent=e.getAttribute("fullId"),t.previousSibling.style.display="none",t.classList.add("pill__replace"),t.classList.remove("pill__initials"));e.className+=" pill--selected",e.addEventListener("click",i)}(t);const c=t.getBoundingClientRect();(function(e,t,n,o){let a=" absolute font-medium";"entity-nav"==e&&(a+=" fs-rr");const i=t.cloneNode(!0);i.className+=a,i.style.left=n.left+"px",i.style.top=n.top+"px",V.getNode("body").appendChild(i),t.style.visibility="hidden",V.getNode(e+" > ul").prepend(t),V.setAnimation(i,{top:o.entityNavTop+4,left:o.entityNavLeft+3},{duration:2}).then(()=>{t.style.visibility="visible",i.remove()})})(o,t,c,s),function(e){const t=V.getNode(e+" > ul").childNodes,n=V.castJson(V.getLocal(e+"-order"));for(let e=0;e<t.length-1;e++){const o=t[e],a=o.getAttribute("path");o.classList.contains("pill--selected")&&(n[a].c?n[a].c+=1:n[a].c=1),n[a].l=e}V.setLocal(e+"-order",n)}(o);const r="service-nav"==o?"entity-nav":"service-nav";V.sA(r,{width:0},{duration:1}),V.setAnimation(o,{width:c.width+11,top:s.entityNavTop,left:s.entityNavLeft},{duration:1}),V.getNode(o).scrollLeft=0}(n)}function t(e,t){const n=Object.values(e).sort((function(e,t){return e.l-t.l})),o=n.slice(t).sort((function(e,t){return t.c-e.c}));return n.slice(0).splice(0,t).concat(o)}function n(e,t){for(const n in e)t.hasOwnProperty(n)||delete e[n];for(const n in t)e.hasOwnProperty(n)||(e[t[n].path]={uuidE:t[n].uuidE,title:t[n].title,tag:t[n].tag,initials:t[n].initials,path:t[n].path},t[n].tinyImage&&(e[t[n].path].tinyImage=t[n].tinyImage))}function o(e){e.stopPropagation();const t=e.target.closest("li");if(t){const e=t.getAttribute("path"),n=t.getAttribute("uuide");V.setState("active",{navItem:e}),V.setBrowserHistory(e),n?V.getNavItem("active",["entityNav"]).draw(n):V.getNavItem("active",["serviceNav","userNav"]).draw(e)}}function a(){const e=document.getElementsByClassName("pill--selected");if(e.length)for(let t=0;t<e.length;t++){const n=e[t].getElementsByClassName("pill__replace")[0];n&&(n.textContent=e[t].getAttribute("initials"),n.previousSibling.style.display="flex",n.classList.add("pill__initials"),n.classList.remove("pill__replace")),e[t].removeEventListener("click",i),e[t].classList.remove("pill--selected")}}function i(e){e.stopPropagation(),V.getNode("form")?(Form.draw("all",{fade:"out"}),Button.draw("all",{fade:"out"}),Button.draw(V.getNavItem("active","serviceNav").use.button,{delay:1.5}),Page.draw({position:"peek",reset:!1})):"/me/edit"==V.getState("active").path&&V.getVisibility("#pref-lang-edit")?EntityList.draw("/me/edit"):(s(),Page.draw({position:"closed",reset:!1,navReset:!1}))}function s(){const e=V.getState("header"),t=window.innerWidth;a();const n=V.castJson(V.getLocal("entity-nav-order")||"{}"),o=Object.keys(n);o.length>=50&&(o.forEach(e=>{n[e].l>40&&(console.log(e),delete n[e])}),V.setLocal("entity-nav-order",n)),Chat.drawMessageForm("clear"),V.setBrowserHistory("/"),V.getVisibility("user-nav")&&(V.setAnimation("user-nav","fadeOut",{duration:.1}).then(()=>{V.setAnimation("user-nav",{width:t})}),V.setAnimation("entity-nav","fadeIn",{duration:.2}),V.setAnimation("service-nav","fadeIn",{duration:.6})),V.setState("active",{navItem:!1}),V.getNode("entity-nav").scrollLeft=0,V.getNode("service-nav").scrollLeft=0,V.setAnimation("entity-nav",{width:t},{duration:1.5}),V.setAnimation("service-nav",{width:t,top:e.serviceNavTop,left:e.serviceNavLeft},{duration:2.5}),Form.draw("all",{fade:"out"}),Button.draw("all",{fade:"out"})}return{draw:function(t){return Promise.resolve(e(function(e,t=("object"==typeof e?e.path:e)){const o=V.castJson(V.getLocal("entity-nav-order")||"{}");!V.getState("entityNav")&&V.setState("entityNav",{});const a=V.getState("entityNav");e&&e.tinyImage&&o[e.path]?o[e.path].tinyImage=JSON.stringify(e.tinyImage):e&&e.images&&e.images.tinyImage&&o[e.path]&&(o[e.path].tinyImage=e.images.tinyImage,o[e.path].useDataUrl=!0);for(const e in o)if(!a[e]){const t={uuidE:o[e].uuidE,title:o[e].title,tag:o[e].tag,initials:o[e].initials,path:o[e].path,draw:function(e){Profile.draw(e)}};o[e].tinyImage&&(t.tinyImage=o[e].tinyImage),V.setNavItem("entityNav",t)}if(e&&e.fullId&&!a[e.path]){const t={uuidE:e.uuidE,title:e.title,tag:e.tag,initials:V.castInitials(e.title),path:e.path,draw:function(e){Profile.draw(e)}};e.tinyImage&&(t.tinyImage=JSON.stringify(e.tinyImage)),V.setNavItem("entityNav",t)}n(o,a),V.setLocal("entity-nav-order",o);const i=V.getNode('[path="'+t+'"]');if(i&&i.closest("header")&&!e.fullId)return{success:!1,status:"navigation does not need updating",data:[{which:t}]};const s=V.castJson(V.getLocal("service-nav-order")||"{}");n(s,V.getState("serviceNav")),V.setLocal("service-nav-order",s);const c=V.castJson(V.getLocal("user-nav-order")||"{}");return n(c,V.getState("userNav")),V.setLocal("user-nav-order",c),{success:!0,status:"navigation updated",data:[{which:t,entityNav:o,userNav:c,serviceNav:s,keep:5}]}}(t)))},drawReset:function(){s()},drawEntityNavPill:function(e){const t={uuidE:e.uuidE,title:e.title,tag:e.tag,initials:V.castInitials(e.title),path:e.path,draw:function(e){Profile.draw(e)}};e.tinyImage&&(t.tinyImage=JSON.stringify(e.tinyImage)),V.setNavItem("entityNav",t);const o=V.castJson(V.getLocal("entity-nav-order")||"{}");n(o,V.getState("entityNav")),V.setLocal("entity-nav-order",o);const a=NavComponents.entityPill(t);V.getNode("entity-nav > ul").prepend(a)}}}();